{{define "page"}}

<div id="admin-content"></div>
<div id="bans">
<form>
    <input type="text" name="ip" placeholder="IP Address">
    <input type="text" name="reason" placeholder="Reason">
    <input hidden type="text" name="username" value="{{.User}}">
    <input type="date" name="expires" placeholder="Expires">
    <a href="#" onclick="return false;">Ban IP</a>
</form>
<script>
    document.querySelector("#bans form a").addEventListener("click", async () => {
        const ip = document.querySelector("#bans form input[name='ip']").value;
        const reason = document.querySelector("#bans form input[name='reason']").value;
        const username = document.querySelector("#bans form input[name='username']").value;
        const expires = document.querySelector("#bans form input[name='expires']").value;
        const formData = new URLSearchParams();
        formData.append('ip', ip);
        formData.append('reason', reason);
        formData.append('username', username);
        formData.append('expires', expires);
        const response = await fetch("/admin/ban", {
            method: "POST",
            headers: {
                "Content-Type": "application/x-www-form-urlencoded"
            },
            body: formData
        });
        if (response.ok) {
            alert("IP banned successfully");
        } else {
            const errorText = await response.text();
            alert(`Failed to ban IP: ${errorText}`);
        }
    });
</script>
        <div class="dashboard-row">
            <div class="dashboard-column">
                <div class="dashboard-box">
                    <h2>Bans</h2>
                    <table>
                        <tr>
                            <th>Time</th>
                            <th>Status</th>
                            <th>IP</th>
                            <th>Reason</th>
                            <th>Expires</th>
                            <th>Actions</th>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <script>
        async function loadBans() {
            const response = await fetch("/api/bans");
            if (response.ok) {
                const bans = await response.json();
                const table = document.querySelector("#bans table");
                bans.forEach(ban => {
                    const row = document.createElement("tr");
                    const time = document.createElement("td");
                    time.textContent = ban.time;
                    row.appendChild(time);
                    const status = document.createElement("td");
                    status.textContent = ban.status;
                    row.appendChild(status);
                    const ip = document.createElement("td");
                    ip.textContent = ban.ip;
                    row.appendChild(ip);
                    const reason = document.createElement("td");
                    reason.textContent = ban.reason;
                    row.appendChild(reason);
                    const expires = document.createElement("td");
                    expires.textContent = ban.expires;
                    row.appendChild(expires);
                    const actions = document.createElement("td");
                    const unban = document.createElement("a");
                    unban.href = "#";
                    unban.textContent = "Unban";
                    unban.addEventListener("click", async () => {
                        const formData = new URLSearchParams();
                        formData.append('ip', ban.ip);
                        const response = await fetch("/admin/unban", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/x-www-form-urlencoded"
                            },
                            body: formData
                        });
                        if (response.ok) {
                            alert("IP unbanned successfully");
                            loadBans();
                        } else {
                            const errorText = await response.text();
                            alert(`Failed to unban IP: ${errorText}`);
                        }
                    });
                    actions.appendChild(unban);
                    row.appendChild(actions);
                    table.appendChild(row);
                });
            } else {
                const errorText = await response.text();
                alert(`Failed to load bans: ${errorText}`);
            }
        }
        loadBans();

        async function loadActiveBans() {
            const response = await fetch("/api/bans/active");
            if (response.ok) {
                const activeBans = await response.json();
                const table = document.querySelector("#bans table");
                activeBans.forEach(ban => {
                    const row = document.createElement("tr");
                    const time = document.createElement("td");
                    time.textContent = ban.time;
                    row.appendChild(time);
                    const status = document.createElement("td");
                    status.textContent = ban.status;
                    row.appendChild(status);
                    const ip = document.createElement("td");
                    ip.textContent = ban.ip;
                    row.appendChild(ip);
                    const reason = document.createElement("td");
                    reason.textContent = ban.reason;
                    row.appendChild(reason);
                    const expires = document.createElement("td");
                    expires.textContent = ban.expires;
                    row.appendChild(expires);
                    const actions = document.createElement("td");
                    const unban = document.createElement("a");
                    unban.href = "#";
                    unban.textContent = "Unban";
                    unban.addEventListener("click", async () => {
                        const formData = new URLSearchParams();
                        formData.append('ip', ban.ip);
                        const response = await fetch("/api/bans/delete", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/x-www-form-urlencoded"
                            },
                            body: formData
                        });
                        if (response.ok) {
                            alert("IP unbanned successfully");
                            loadBans();
                        } else {
                            const errorText = await response.text();
                            alert(`Failed to unban IP: ${errorText}`);
                        }
                    });
                    actions.appendChild(unban);
                    row.appendChild(actions);
                    table.appendChild(row);
                });
            } else {
                const errorText = await response.text();
                alert(`Failed to load active bans: ${errorText}`);
            }
        }

        async function loadExpiredBans() {
            const response = await fetch("/api/bans/expired");
            if (response.ok) {
                const expiredBans = await response.json();
                const table = document.querySelector("#bans table");
                expiredBans.forEach(ban => {
                    const row = document.createElement("tr");
                    const time = document.createElement("td");
                    time.textContent = ban.time;
                    row.appendChild(time);
                    const status = document.createElement("td");
                    status.textContent = ban.status;
                    row.appendChild(status);
                    const ip = document.createElement("td");
                    ip.textContent = ban.ip;
                    row.appendChild(ip);
                    const reason = document.createElement("td");
                    reason.textContent = ban.reason;
                    row.appendChild(reason);
                    const expires = document.createElement("td");
                    expires.textContent = ban.expires;
                    row.appendChild(expires);
                    const actions = document.createElement("td");
                    const unban = document.createElement("a");
                    unban.href = "#";
                    unban.textContent = "Unban";
                    unban.addEventListener("click", async () => {
                        const formData = new URLSearchParams();
                        formData.append('ip', ban.ip);
                        const response = await fetch("/api/bans/delete", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/x-www-form-urlencoded"
                            },
                            body: formData
                        });
                        if (response.ok) {
                            alert("IP unbanned successfully");
                            loadBans();
                        } else {
                            const errorText = await response.text();
                            alert(`Failed to unban IP: ${errorText}`);
                        }
                    });
                    actions.appendChild(unban);
                    row.appendChild(actions);
                    table.appendChild(row);
                });
            } else {
                const errorText = await response.text();
                alert(`Failed to load expired bans: ${errorText}`);
            }
        }

    </script>

</div>
<style>
#admin {
    margin: 0 auto;
    width: 80%;
}
#admin-content {
    margin-top: 20px;
}
#bans {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
}
#bans form {
    display: flex;
    flex-direction: row;

}


#bans form a {
    background-color: #1a1a1a;
    border: 1px solid #ddd;
    border-radius: 5px;
    color: white;
    padding: 10px;
    text-decoration: none;
    width: 100px;
}

#bans form a:hover {
    background-color: #333;
}


.dashboard-row {
    display: flex;
    flex-wrap: wrap;
}
.dashboard-column {
    flex: 1;
    margin: 0 10px;
}
.dashboard-box {
    background-color: #1a1a1a;
    border: 1px solid #ddd;
    border-radius: 5px;
    margin: 10px 0;
    padding: 10px;
}
table {
    width: 100%;
}
table th {
    background-color: #1a1a1a;
    border-bottom: 1px solid #ddd;
    padding: 10px;
    text-align: left;
}




</style>
{{end}}